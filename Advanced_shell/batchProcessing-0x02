#!/usr/bin/env bash
set -euo pipefail
POKEMON=(bulbasaur ivysaur venusaur charmander charmeleon); mkdir -p pokemon_data; for p in "${POKEMON[@]}"; do tries=0; ok=0; echo "Fetching data for $p..."; while [ $tries -lt 3 ] && [ $ok -eq 0 ]; do CODE=$(curl -sS -H 'User-Agent: alx-shell' -w '%{http_code}' -o "pokemon_data/$p.json.tmp" "https://pokeapi.co/api/v2/pokemon/$p" || echo "000"); if [ "$CODE" = "200" ]; then mv "pokemon_data/$p.json.tmp" "pokemon_data/$p.json"; echo "Saved data to pokemon_data/$p.json âœ…"; ok=1; else sleep 1; tries=$((tries+1)); fi; done; [ $ok -eq 1 ] || { echo "$(date -Is) ERROR $CODE while fetching $p" >> errors.txt; rm -f "pokemon_data/$p.json.tmp"; }; sleep 0.5; done
